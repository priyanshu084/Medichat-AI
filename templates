<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="description" content="AI Health Chatbot - Get instant health advice based on your symptoms">
    <title>MediChat AI - Your Health Assistant</title>
    <link href="https://fonts.googleapis.com/css2?family=Sora:wght@300;400;600;700&family=DM+Sans:wght@400;500;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="{{ url_for('static', filename='style.css') }}">
</head>
<body>
    <!-- Main Container -->
    <div class="container">
        <!-- Header Section -->
        <div class="header">
            <div class="header-content">
                <div class="logo">MediChat AI</div>
                <div class="subtitle">Your intelligent health companion ‚Ä¢ Available 24/7</div>
            </div>
        </div>

        <!-- Chat Container -->
        <div class="chat-container" id="chatContainer">
            <!-- Welcome Message -->
            <div class="message bot">
                <div class="avatar bot">ü§ñ</div>
                <div class="message-content">
                    <div class="message-bubble">
                        Hello! I'm MediChat AI, your health assistant. üëã
                        <br><br>
                        I can help you understand your symptoms and provide general health guidance. Please describe your symptoms, and I'll do my best to assist you.
                    </div>
                    <div class="disclaimer">
                        I provide general information only. For emergencies, call 911. Always consult a healthcare professional for medical advice.
                    </div>
                    <div class="suggestions">
                        <div class="suggestion-chip" onclick="sendSuggestion('I have a fever and headache')">üå°Ô∏è Fever & Headache</div>
                        <div class="suggestion-chip" onclick="sendSuggestion('I have a persistent cough')">üò∑ Cough</div>
                        <div class="suggestion-chip" onclick="sendSuggestion('I have stomach pain')">ü§¢ Stomach Pain</div>
                        <div class="suggestion-chip" onclick="sendSuggestion('I have a sore throat')">ü§í Sore Throat</div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Input Area -->
        <div class="input-area">
            <div class="input-wrapper">
                <input type="text" id="userInput" placeholder="Describe your symptoms..." autocomplete="off">
            </div>
            <button id="sendBtn" onclick="sendMessage()">Send</button>
        </div>
    </div>

    <script>
        // Send message function
        function sendMessage() {
            const input = document.getElementById('userInput');
            const message = input.value.trim();
            
            if (message === '') return;
            
            // Add user message to chat
            addUserMessage(message);
            input.value = '';
            
            // Show typing indicator
            setTimeout(() => {
                showTypingIndicator();
                
                // Send to backend
                fetch('/chat', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify({ message: message })
                })
                .then(response => response.json())
                .then(data => {
                    hideTypingIndicator();
                    handleBotResponse(data);
                })
                .catch(error => {
                    hideTypingIndicator();
                    addBotMessage(`
                        <div class="message-bubble">
                            Sorry, I encountered an error. Please try again.
                        </div>
                    `);
                    console.error('Error:', error);
                });
            }, 300);
        }

        // Send suggestion
        function sendSuggestion(text) {
            document.getElementById('userInput').value = text;
            sendMessage();
        }

        // Add user message to chat
        function addUserMessage(message) {
            const chatContainer = document.getElementById('chatContainer');
            const messageDiv = document.createElement('div');
            messageDiv.className = 'message user';
            messageDiv.innerHTML = `
                <div class="avatar user">üë§</div>
                <div class="message-content">
                    <div class="message-bubble">${escapeHtml(message)}</div>
                </div>
            `;
            chatContainer.appendChild(messageDiv);
            scrollToBottom();
        }

        // Add bot message to chat
        function addBotMessage(content) {
            const chatContainer = document.getElementById('chatContainer');
            const messageDiv = document.createElement('div');
            messageDiv.className = 'message bot';
            messageDiv.innerHTML = `
                <div class="avatar bot">ü§ñ</div>
                <div class="message-content">
                    ${content}
                </div>
            `;
            chatContainer.appendChild(messageDiv);
            scrollToBottom();
        }

        // Handle bot response from backend
        function handleBotResponse(data) {
            if (data.type === 'emergency') {
                const instructions = data.emergency_info.instructions.map(inst => 
                    `<br>‚Ä¢ ${inst}`
                ).join('');
                
                addBotMessage(`
                    <div class="message-bubble">
                        ${data.message}
                    </div>
                    <div class="emergency-alert">
                        <div class="alert-header">${data.emergency_info.title}</div>
                        <div class="alert-body">
                            Your symptoms may indicate a serious medical emergency. Please:
                            ${instructions}
                        </div>
                    </div>
                `);
            } else if (data.type === 'diagnosis') {
                addBotMessage(`
                    <div class="message-bubble">
                        Based on your symptoms, here's what I found:
                    </div>
                    <div class="disease-card">
                        <div class="disease-name">${capitalizeFirst(data.disease)}</div>
                        <div class="disease-info">${data.info}</div>
                        <div class="severity-badge severity-${data.severity}">
                            Severity: ${capitalizeFirst(data.severity)}
                        </div>
                        <div class="recommendations">
                            <strong>üí° Recommendations:</strong>
                            ${data.recommendations}
                        </div>
                    </div>
                    <div class="disclaimer">
                        This is general information based on common symptoms. Please consult a healthcare professional for proper diagnosis and treatment. If symptoms worsen or persist, seek medical attention.
                    </div>
                `);
            } else if (data.type === 'no_match') {
                const suggestions = data.suggestions.map(sug => 
                    `<br>‚Ä¢ ${sug}`
                ).join('');
                
                addBotMessage(`
                    <div class="message-bubble">
                        ${data.message}
                        <br><br>
                        Here's what I recommend:
                        ${suggestions}
                        <br><br>
                        Can you provide more specific details about your symptoms? For example, duration, severity, and any other symptoms you're experiencing.
                    </div>
                    <div class="disclaimer">
                        For a proper diagnosis, please consult with a qualified healthcare professional.
                    </div>
                `);
            }
        }

        // Show typing indicator
        function showTypingIndicator() {
            const chatContainer = document.getElementById('chatContainer');
            const typingDiv = document.createElement('div');
            typingDiv.className = 'message bot';
            typingDiv.id = 'typingIndicator';
            typingDiv.innerHTML = `
                <div class="avatar bot">ü§ñ</div>
                <div class="message-content">
                    <div class="typing-indicator">
                        <div class="typing-dot"></div>
                        <div class="typing-dot"></div>
                        <div class="typing-dot"></div>
                    </div>
                </div>
            `;
            chatContainer.appendChild(typingDiv);
            scrollToBottom();
        }

        // Hide typing indicator
        function hideTypingIndicator() {
            const indicator = document.getElementById('typingIndicator');
            if (indicator) {
                indicator.remove();
            }
        }

        // Escape HTML to prevent XSS
        function escapeHtml(text) {
            const div = document.createElement('div');
            div.textContent = text;
            return div.innerHTML;
        }

        // Capitalize first letter of each word
        function capitalizeFirst(str) {
            return str.split(' ').map(word => 
                word.charAt(0).toUpperCase() + word.slice(1)
            ).join(' ');
        }

        // Scroll to bottom of chat
        function scrollToBottom() {
            const chatContainer = document.getElementById('chatContainer');
            chatContainer.scrollTop = chatContainer.scrollHeight;
        }

        // Enter key to send message
        document.getElementById('userInput').addEventListener('keypress', function(e) {
            if (e.key === 'Enter') {
                sendMessage();
            }
        });
    </script>
</body>
</html>
